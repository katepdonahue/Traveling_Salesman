
<%= render 'map' %>

<script type="text/javascript">
  var data = new Object();
  var data1 = null;
  <% @data.each do |route_id, route_hash| %>
    var routeId = String(<%= route_id %>);
    data[routeId] = new Object();
    <% route_hash.each do |sub_route_id, address_arr| %>
      var subRouteId = String(<%= sub_route_id %>);
      var subRouteHash = new Object();
      subRouteHash["origin"] = "<%= address_arr.first %>";
      subRouteHash["destination"] = "<%= address_arr.last %>";
      // subRouteHash["departureTime"] = 1391530628316;
      subRouteHash["travelMode"] = google.maps.TravelMode.DRIVING;

      directionsService.route(subRouteHash, function(response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
          data[routeId][subRouteId] = response;
        }
      });

    <% end %>
  <% end %>
  // this works if you copy paste it into the console.
  // async problem
  jQuery.each(data, function(key, val) {
    jQuery.each(val, function(subrk, subrv) {
      directionsDisplay.setDirections(subrv);
    });
  });
    
</script>



